---
import { storyblokEditable } from '@storyblok/astro';
import { Card, CardDescription, CardTitle } from '~/components/ui/card';
import OptimisedImage from '~/components/OptimisedImage.astro';
import Icon from '~/components/Icon.astro';

const { blok } = Astro.props;
const { title, excerpt, slug, cardClasses, image } = blok;

// Handle Storyblok image format - could be a string URL or an object with filename
const imageUrl = typeof image === 'string' ? image : image?.filename;
const hasValidImage = imageUrl && imageUrl.trim() !== '';
---

<a
  href={`/articles/${slug}`}
  class="block group"
  {...storyblokEditable(blok)}
>
  <Card
    className={`hover:scale-[1.01] hover:shadow-lg transition-all duration-300 h-full flex flex-col overflow-hidden border rounded-xl cursor-pointer ${cardClasses || ''}`}
  >
    <!-- Image Section - Full width, no padding -->
    <div class="relative overflow-hidden">
      {
        hasValidImage ? (
          <OptimisedImage
            src={imageUrl}
            alt={title}
            class="w-full h-48 object-cover"
          />
        ) : (
          <!-- Fallback gradient background with GreenTech logo -->
          <div class="w-full h-48 bg-gradient-to-br from-primary to-primary-dark flex items-center justify-center group">
            <img
              src="/greentech-logo.svg"
              alt="GreenTech Logo"
              class="w-2/3 filter invert opacity-70"
            />
          </div>
        )
      }
    </div>

    <!-- Content Section - With padding -->
    <div class="flex flex-col flex-grow px-6 py-4">
      <!-- Title -->
      <CardTitle className="mb-3">
        <span class="leading-[1.3]">
          {title}
        </span>
      </CardTitle>

      <!-- Excerpt -->
      {excerpt && <CardDescription className="line-clamp-3 mb-4">{excerpt}</CardDescription>}

      <!-- Spacer -->
      <div class="flex-grow"></div>

      <!-- Read More Link -->
      <div class="flex items-center text-primary group-hover:text-primary font-medium gap-1">
        Read more
        <Icon name="arrow-right" />
      </div>
    </div>
  </Card>
</a>
