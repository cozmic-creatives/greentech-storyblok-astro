---
import BaseLayout from '~/layouts/BaseLayout.astro';
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro';
import Icon from '~/components/Icon.astro';
import { getStoryblokStory } from '~/lib/storyblok';
import { extractSEOFromStory } from '~/utils/seo';

const story = await getStoryblokStory('privacy-policy');

// Extract SEO data from the story with privacy policy-specific fallbacks
const seo = extractSEOFromStory(story, {
  title: 'Privacy Policy - GREENTECH Sustainable Solutions',
  description:
    "Read GREENTECH's privacy policy to understand how we collect, use, and protect your personal information when using our sustainable plastic solutions.",
  keywords: 'privacy policy, greentech privacy, data protection, sustainable plastic solutions',
  openGraph: {
    type: 'website',
  },
  noindex: true, // Privacy policies are typically not indexed
});
---

<BaseLayout seo={seo}>
  <StoryblokComponent blok={story.content} />

  <!-- Privacy Tracking Controls -->
  <div class="container pb-10 text-center">
    <button
      id="manage-tracking-btn"
      class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors shadow-md"
    >
      <Icon name="shield-check" class="text-xl" />
      Manage Tracking Preferences
    </button>
  </div>

  <script>
    import { showPrivacyBanner } from '~/utils/consent';

    function attachPrivacyButtonListener() {
      const button = document.getElementById('manage-tracking-btn');
      if (button) {
        button.addEventListener('click', () => showPrivacyBanner('controls'));
      }
    }

    // Attach listener on initial load
    attachPrivacyButtonListener();

    // Re-attach listener after view transitions
    document.addEventListener('astro:page-load', attachPrivacyButtonListener);
  </script>
</BaseLayout>
